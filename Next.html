<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Divvy Van Navigator Next</title>
        <link rel="stylesheet" href="main.css">

<link rel="apple-touch-icon" sizes="180x180" href="./images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16x16.png">
<link rel="manifest" href="./site.webmanifest">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css" type="text/css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jmespath/0.16.0/jmespath.min.js" integrity="sha512-w/sNKK/59oJUi6v+SjgfIijrkFN8Pfv5QFZSV4KvrNMJrlbVM3017ZGNCA2AwZ6PKJzTPxQaDs/TbPcVGnF+pQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-asm.min.js" integrity="sha512-M9xUGlk2uqL+OPfrMe2ist2SdfNZ3o6D2GXc5f5AFs0p86B21oBWJ7+2ZwOaRuHTTHBbbOrYJzx7O4n4HMaA1A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><script> 
  $(function(){
    $("#navbar").load("navbar.html",function() {
      $('a').each(function(){
            if ($(this).prop('href') == window.location.href) {
                $(this).addClass('active'); $(this).parents('li').addClass('active');
            }
          })
}); 
   
  });
  </script> 

</head>
<body>
  <div id="navbar"></div>

    <div class="container">
    <div  class = "map" id="directionMap"></div>
    <div class= "overlay" id="instructions">
    </div>
    
</div>

 
<div class="sticky-top alert-hidden rounded">
  <p>This webpage would like to play sounds</p>
  <!-- <p class="buttons"> -->
    <button class="btn btn-primary"id="allow" value="1">Allow</button>
    <button class="btn btn-primary" value="0">Block</button>
 
</div>
<!-- <div>
  <img class ="about" src="./images/about.png" alt=" About" id="about" width="100%" height="300px" bottom = "0px" >
</div> -->
<!-- <img class ="biker" src="./images/bike.png" alt=" BIKER" width="75" height="75"> -->
</body>
<footer>
  
  <script type="module">
    import EasySpeech from 'https://cdn.skypack.dev/easy-speech';


   var permission = false











    const elem = document.querySelector("#instructions");
    var listItem = elem.getElementsByTagName("li");

    var prevText = ""
    EasySpeech.init({ maxTimeout: 5000, interval: 250 })
    .catch(e => console.error(e))
 async  function speak(){
  const voice =  EasySpeech.voices() // get a voice you like
    const voiceFiltered = voice.filter(function(el){
    return el.lang.toLowerCase().includes('jp')})

//for (var i=0; i < listItem.length; i++) { //for loop reads every list item

  try{
     await EasySpeech.speak({
      text: listItem[0].innerText.trim(),//listItem[i].innerText.trim(),
      voice: voiceFiltered[0],
      pitch: 1,  // a little bit higher
      rate: 1, // a little bit faster
      volume: 1
        })
  }
  catch(e){
  console.error(e)
  }
 // }
}
// Listen for the event.
elem.addEventListener('voice', (e) => { 
    let detect = EasySpeech.detect()
  if(/*permission &&*/ prevText != elem.innerText && detect.speechSynthesis !== undefined && detect.speechSynthesisUtterance !== undefined)
{
  
    


   speak();

    prevText = elem.innerText;
 




 
 
  }


 }, false)
//  const audio = new Audio( 'https://dl.dropboxusercontent.com/s/h8pvqqol3ovyle8/tom.mp3' );
// audio.muted = true;

// const alert_elem = document.querySelector( '.alert' );

// audio.play().then( () => {
//   // already allowed
//   alert_elem.remove();
//   resetAudio();
// } )
// .catch( () => {
//   // need user interaction
//   alert_elem.addEventListener( 'click', ({ target }) => {
//     if( target.matches('button') ) {
//       const allowed = target.value === "1";
//       if( allowed ) {
       
//         const voiceEvent = new Event('voice');
//   const inst = document.querySelector('#instructions');
//   //permission = true

// inst.dispatchEvent(voiceEvent);
//       }
//       alert_elem.remove();
//     }
//   } );
// } );



// function resetAudio() {
//   audio.pause();
//   audio.currentTime = 0;
//   audio.muted = false;
// }


  </script>
    <script  src="DivvyApp.js"></script>
    
  </footer>
<!-- https://developers.google.com/optimization/routing/penalties#python_3 find path -->
</html>